### 消息队列和事件循环
![avatar](../../img/for.png)
![avatar](../../img/task.jpg)
1. 消息队列（先进先出）中的任务是宏任务
2. 单线程的缺点
   - 如何处理高优先级的任务（微任务：权衡效率和实时性）
   - 如何解决单个任务执行时长过久的问题（回调）

### setTimeout
1. 使用 setTimeout 设置的回调函数中的 this 不符合直觉
```js
var name= 1;
var MyObj = {
  name: 2,
  showName: function(){
    console.log(this.name);
  }
}
setTimeout(MyObj.showName,1000)   // 1


//箭头函数
setTimeout(() => {
    MyObj.showName()   // 2
}, 1000);
//或者function函数
setTimeout(function() {
  MyObj.showName();  // 2
}, 1000)

setTimeout(MyObj.showName.bind(MyObj), 1000) // 2
```
2. 如果当前任务执行时间过久，会影延迟到期定时器任务的执行
### 微任务
1. 异步回调
   - 把异步回调函数封装成一个宏任务，添加到消息队列尾部，当循环系统执行到该任务的时候执行回调函数（setTimeout 和 XMLHttpRequest 的回调函数都是通过这种方式来实现的）
   - 把异步回调函数封装成一个微任务

2. 在一个宏任务中，分别创建一个用于回调的宏任务和微任务，无论什么情况下，微任务都早于宏任务执行。
3. 使用 Promise，当调用 Promise.resolve() 或者 Promise.reject() 的时候，也会产生微任务。
4. 我们把宿主发起的任务称为宏观任务，把 JavaScript 引擎发起的任务称为微观任务
   
